### 1. List all of the annotations you learned from class and homework to annotaitons.md.

### 2. Type the code, you need to checkout new branch from branch 02_post_RUD, name the new branch with https://github.com/TAIsRich/springboot-redbook/tree/hw05_01_slides_JPQL.

### 3. What is JPQL?
The JPQL (Java Persistence Query Language) is an object-oriented query language. J{QL} is used to perform database operations on persistent entities.


### 4. What is `@NamedQuery` and `@NamedQueries`?
`@NamedQuery`: The annotation is used to define the single named query. The JPQL statement uses the class name(Post) of the entity.
`@NamedQueries`: The annotation is used to define the multiple named queries.

```
@Entity
@NamedQueries({
    @NamedQuery(name = "Book.findByTitle", query = "SELECT b FROM Book b WHERE b.title = :title"),
    @NamedQuery(name = "Book.findByPublishingDate", query = "SELECT b FROM Book b WHERE b.publishingDate = :publishingDate")
})
public class Book implements Serializable {
    ...
}
```


### 5. What is `@Query`? In which Interface we write the SQL or JPQL?
The `@Query` annotation can only be used to annotate repository interface methods.  

JPQL: The query definition uses JPQL.
```
@Query("SELECT u FROM User u WHERE u.status = 1")
Collection<User> findAllActiveUsers();
```

SQL: set the value of the nativeQuery attribute to true and define the native SQL query in the value attribute of the annotation
```
@Query(
  value = "SELECT * FROM USERS u WHERE u.status = 1", 
  nativeQuery = true)
Collection<User> findAllActiveUsersNative();
```


### 6. What is HQL and Criteria Queries?
Hibernate Query Language (HQL) is an object-oriented query language, similar to SQL. But HQL works with persistent objects and their properties.  
Criteria in Hibernate can be used for join queries by joining multiple tables.


### 7. What is EntityManager?
A JPA `EntityManager` manages connection to a database as well as to database operations. `EntityManager` is associated with a `PersistenceContext`. All operations that are performed in a specific session are stored inside the `PersistenceContext`.  

`EntityManager` is the interface to the `Persistence Context`. All operations on the entity go through the `EntityManager`. We will declare an `EntityManager` object in our class and mark it with the `@PersistenceContext` annotation.  

We must use `@Transactional` since the operation should be atomic. And `EntityManager` provides a number of methods that perform `SELECT`, `INSERT`, `UPDATE`, and `DELETE` queries.
```
@Repository
@Transactional
public class PostJPQLRepositoryImpl implements PostJPQLRepository {
    @PersistenceContext
    EntityManager entityManager;
    ... 
}
```


### 8. What is SessionFactory and Session?
SessionFactory: SessionFactory is an Interface which is present in org.hibernate package. SessionFactory is used to create Session Object.  

Session: The session object provides an interface between the application and data stored in the database.


### 9. What is Transaction? How to manage your transaction?
Transaction: A transaction simply represents a unit of work.  
How to manage transaction:  
    1) Create a sessionFactory according to the configuration file.  
    2) Create a session from the sessionFactory.  
    3) Begin transaction for the session. (`transaction = session.beginTransaction();`)  
    4) Execute txn. (`Post savedPost = (Post) session.merge(post);`)  
    5) commit txn. (`transaction.commit();`)   Rollback if failed. (`transaction.rollback();`)  
    6) Close session.


### 10. What is hibernate Caching?
**Priority: first-level cache > secodn-level cache > database**  
Hibernate caching acts as a layer between the actual database and your application.  
Hibernate provides two level cache, First-level cache and Second-level cache.  
First-level cache:  
    1) Hibernate first level cache is session specific. When we are getting the same data in same session, there is no query fired whereas in other session query is fired to load the data.  
    2) Hibernate first level cache can have old values. (Two session works on the same object ==> one session holds new value, and another session can hold old value.)  
Second-level cache:  
    1) If an instance is already present in the first-level cache, it is returned from there.  
    2) If an instance is not found in the first-level cache, and the corresponding instance state is cached in the second-level cache, then the data is fetched from there and an instance is assembled and returned.  
    3) Otherwise, the necessary data are loaded from the database and an instance is assembled and returned.

### 11. What is the difference between first-level cache and second-level cache?
first-level cache: Stays in session level. Purpose: minimize database visit.  
second-level cache: Stays in sessionFactory. Purpose: cross session use.


### 12. How do you understand `@Transactional`? https://github.com/TAIsRich/tutorial-transaction
1) In question 9, we discuss the Transaction and Session.  
2) `@Transactional`:  
    a) `@EnableTransactionManagement` in application 
    b) `@Transactional` in method  


### 13. Write a simple factory design pattern.