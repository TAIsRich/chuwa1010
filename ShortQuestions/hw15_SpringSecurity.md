# HW15 Spring Security
## 1.  List all of the annotations you learned from class and homework to annotaitons.md
## 2.  What is HTTP Session?
HTTP session allows web servers to maintain user identity and to store user-specific data during multiple request/response 
interactions between a cline application and a web application.

## 3.  What is Cookie?
An Http cookie is a small piece of data that a server sends to a user's  web browser. It is used to tell if two requests come from the same browser: keeping a user
logged in, for example.

## 4.  What is the difference between Session and Cookie?
Coolies are cline-side files on a local computer that hold user information.
Seesions are server-side files that contain user data.

## 5.  How do we use session and cookie to keep user information across the application?
https://www.javatpoint.com/session-vs-cookies
### Session:
* A session is used to temporarily store the information on the server to be used across multiple pages of the website. 
* The user session starts when he logs-in to a particular network application and ends when the user logs out from the application or shutdown the system.
* The user information is stored in session variables, and there variables can store any type of value or data type of an object.
* Session values are much secured as these are stored in binary form or encrypted form and can only be decrypted at the server. The session values are 
automatically removed when the user shutdowns the system or logout from the application. To store the values permanently, we need to store them in the database.
* Each session is unique for each user, and any number of sessions can be used in an application; there is no limitation to it.
* The user is identified with the help of sessionID, which is a unique number saved inside the server. It is saved as a cookie, form field, or URL.
#### Working of Session:
1.   In the first step, the client request to the server via GET or POST method.
2.   The sessionID is created on the server, and it saves the sessionID into the database. It returns the sessionId with a cookie as a response to the client.
3.   Cookie with sessionID stored on the browser is sent back to the server. The server matches this id with the saved sessionID and sends a response HTTP200
#### Why Use Session?
* Sessions are used to store information such as UserID over the server more securely, where it cannot be tempered.
* It can also transfer the information in the form of value from one web page to another.
* It can be used as an alternative to cookies for browsers that don't support cookies to store variables in a more secure way.
### Cookie:
* A cookie is a small text file that is stored on the user's computer. The maximum file size of a cookie is 4KB.Whenever a user visits a website for the first time, 
* the site sends packets of data in the form of a cookie to the user's computer.
* The cookies help the websites to keep track of the user's browsing history or cart information when they visit their sites.
* It stores only the "String" data type.
* The information stored within cookies is not secure because this information is stored in text-format on the client-side, which can be read by anyone.
* We can enable or disable the cookies as per the requirement.
* The cookies generated by a user are only be shown to them, and no other user can see those cookies.
* Cookies are created and shared between the server and browser with the help of an HTTP header.
* The path where the cookies are saved is decided by the browser, as Internet explorer usually stored them in Temporal Internet File Folder.
#### Cookies Attribute:
Name: It defines the name of the cookie.
Value: It defines the value of the cookie.
Expire: It specifies the time when the cookie will expire. If it is not used or set as 0, cookies will be deleted at the end of the session.
Path: It defines the server path of the cookie. If it is set to "/", the cookie will be available within the complete domain.
Domain: It defines the domain name of the cookies. If we set it "javatpoint.com", it will be available for all subdomains of javatpoint.com.
Secure: It specifies that if the cookies are only transmitted over HTTPS or not. If it is set True, it means cookies will only be set for the secured connection.
HTTPOnly: If it is set to TRUE, the cookies will be accessible through the HTTP protocol.
#### Why use Cookies?
HTTP is a stateless protocol; hence it does not store any user information. For this purpose, we can use Cookies. 
It allows us to store the information on the user's computer and track the state of applications.

## 6.  What is the spring security filter?
A security filter describes a set of records in a table that a user has permission to access. You can specify, for example, 
that a user can only read the records that contain information about a particular customer. This means that the user cannot access the records 
that contain information about other customers.
For a web application using Spring security, all incoming HttpServletRequest goes through the spring security filters chain before it reaches 
to the Spring MVC controller.
The Spring Security filter contains a list of filter chains and dispatches a request to the first chain that matches it. Spring Security maintains 
a filter chain internally where each of the filters has a particular responsibility and filters are added or removed from the configuration depending 
on which services are required.
### Some important filters:
* UsernamePasswordAuthenticationFilter – Looks for the username and password in the request and tries to authenticate if found these parameters in the request.
* SecurityContextPersistenceFilter – Populates the SecurityContextHolder with information got from the configured.
* ConcurrentSessionFilter – Filter for handling concurrent session.
* DefaultLoginPageGeneratingFilter –Generates a login page for you, if you don’t explicitly disable that feature.

Resource: https://www.javadevjournal.com/spring-security/spring-security-filters/

## 7. Do you use any Encoder to encode Password?
Using the `BCryptPasswordEncoder` to encode and store the password securely. It implements `PasswordEncoder` in Spring and uses the BCrypt hashing function.
`encode()`: encode the raw password
`matches()`: compare the encoded password in storage with the submitted raw password

## 8.  What is UserDetailService? AuthenticationProvider?AuthenticationManager? AuthenticationFilter?(把这几个名字看熟悉也行)
`AuthenticationFilter`: response for spring security, has particular responsibility
`AuthenticationManager`: an interface and implemented by `ProviderManager` which delegates a list of `AuthenticationProvider`s
`AuthenticationProvider`: an interface with a single authenticate method, it authenticates the input **authentication object** with the **user object** that fetched by `UserDetailService`
`UserDetailService`: an interface with a single method named `loadUserByUsername()`, it is used to fetch the **user object** based on the username
*For the manager and provider, the input is Authentication Object with **Credentials** while the output is Authentication Object with **Principal**.
A Principal ia an object, represents a user's identity.

## 9.  What is the disadvantage of Session? how to overcome the disadvantage?
Disadvantages: 
1. Performance overhead in case of large number of user, because of session data stored in server memory. 
2. Overhead involved in serializing and De-Serializing session data because in case of StateServer and SQLServer session mode we need to serialize the object before store.
3. multiple servers, the request could be redirected to different server by the load balancer
Solutions:
    - sticky session feature: the load balancer remembers the user and its initial server
    - shared session cache: e.g. redis
    - JWT

## 10. What is JWT?
Jason web token. The token is generated by the server upon the user authentication and then sent back to the user. It is sent with every HTTP request and used for 
authorizing requests between user and server. It is a json object contains three parts: header, payload, and signature.

## 11. decribe how do JWT work(slides 里有图， 26页)
1. User logs in and the server do the authentication, once successful the JWT is generated and send back to the user;
2. User inserts the JWT into the Authorization header at each http request;
3. the server validates the JWT and returns the response.

## 12. how to get value from application.properties?
Use the annotation: @value
Example: get the app.jwt-secret from application.properties
```java
//application.properties
app.jwt-secret= JWTSecretKey
app.jwt-expiration-milliseconds = 604800000
```
```java
//JwtTokenProvider.java
public class JwtTokenProvider {
   @Value("${app.jwt-secret}")
   private String jwtSecret;
}
```
## 13. What is the role of configure(HttpSecurity http) and configure(AuthenticationManagerBuilder auth)?
- `configure(HttpSecurity http)`
  This method creates a `HttpSecurity` object which allows us to implement the **authorization**.=
- `configure(AuthenticationManagerBuilder auth)`
  This method creates an object of `AuthenticationManagerBuilder` which allows us to configure the security information for user authentication. 
The main security information includes **authentication** type (in-memory, ldap, jdbc) and user details.
Code example:
```java
 @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .csrf().disable()
                .exceptionHandling()
                .authenticationEntryPoint(authenticationEntryPoint)
                .and()
                .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeRequests()
                .antMatchers("/api/v1/auth/**").permitAll()
                .and()
                .authorizeRequests()
                .antMatchers(HttpMethod.POST,"/api/v1/**").hasRole("ADMIN")
                .anyRequest()
                .authenticated();

        http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
    }
```
- Resources: https://medium.com/@er.rameshkatiyar/configure-spring-security-in-your-application-ae303fa78959

## 14. What is Spring security authentication and authorization?
Authentication: verifies the identity of the user.
Authorization: ensures thte user can only access the parts of a resource which they are authorized to access.

## 15. Reading, 泛读一下即可，自己觉得是重点的，可以多看两眼。https://www.interviewbit.com/spring-security-interview-questions/#is-security-a-cross-cutting-concern
    a. 1-12
    b. 17 - 30
 